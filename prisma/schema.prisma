// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  PENDING
  ACTIVATED
  DEACTIVATED
}

enum UserGroupRole {
  ADMIN
  MAINTAINER
  PARTICIPANT
}

enum UserGroupStatus {
  PENDING
  ACTIVATED
  DEACTIVATED
}

model User {
  id           Int        @id @default(autoincrement())
  uuid         String     @unique @default(uuid()) @db.Uuid
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  email        String     @unique
  nickname     String     @unique
  name         String
  password     String
  confirmEmail Boolean    @default(false) @map("confirm_email")
  status       UserStatus @default(PENDING)
  title        String?
  aboutMe      String?    @map("about_me")
  companyName  String?    @map("company_name")
  companyRole  String?    @map("company_role")
  photoUrl     String?    @map("photo_url")

  groups           UserGroup[]
  events           UserEvent[]
  recoveryPassword RecoveryPassword[]
  degree           Degree?
  socialNetworks   SocialNetwork[]
  knowledge        Knowledge[]
  EventComment     EventComment[]

  @@map("user")
}

model Group {
  id          Int         @id @default(autoincrement())
  uuid        String      @unique @default(uuid()) @db.Uuid
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  name        String
  description String
  slug        String      @unique
  coverUrl    String?
  users       UserGroup[]
  events      Event[]

  @@map("group")
}

model UserGroup {
  id          Int             @id @default(autoincrement())
  user        User            @relation(fields: [fk_id_user], references: [id])
  fk_id_user  Int
  group       Group           @relation(fields: [fk_id_group], references: [id])
  fk_id_group Int
  role        UserGroupRole   @default(PARTICIPANT)
  status      UserGroupStatus @default(ACTIVATED)

  @@map("user_group")
}

model Event {
  id                Int            @id @default(autoincrement())
  uuid              String         @unique @default(uuid()) @db.Uuid
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  name              String
  description       String
  coverUrl          String?
  slug              String         @unique
  initialDate       DateTime       @map("initial_date")
  finishDate        DateTime       @map("finish_date")
  address           String
  limitParticipants Int            @map("limit_participants")
  users             UserEvent[]
  group             Group?         @relation(fields: [groupId], references: [id])
  groupId           Int?
  EventComment      EventComment[]

  @@map("event")
}

model UserEvent {
  id          Int   @id @default(autoincrement())
  user        User  @relation(fields: [fk_id_user], references: [id])
  fk_id_user  Int
  event       Event @relation(fields: [fk_id_event], references: [id])
  fk_id_event Int

  @@map("user_event")
}

model RecoveryPassword {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(uuid()) @db.Uuid
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  user       User     @relation(fields: [fk_id_user], references: [id])
  fk_id_user Int
  isUsed     Boolean  @default(false)

  @@map("recovery_password")
}

enum Degree {
  UNDER_GRADUATE
  GRADUATE
  MASTER
  DOCTOR
}

enum SocialNetworkType {
  FACEBOOK
  LINKEDIN
  GITHUB
  TWITTER
}

model SocialNetwork {
  id         Int               @id @default(autoincrement())
  createdAt  DateTime          @default(now()) @map("created_at")
  updatedAt  DateTime          @updatedAt @map("updated_at")
  user       User              @relation(fields: [fk_id_user], references: [id])
  fk_id_user Int
  type       SocialNetworkType
  link       String

  @@unique([fk_id_user, type])
  @@map("social_network")
}

model Knowledge {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [fk_id_user], references: [id])
  fk_id_user  Int
  name        String
  description String

  @@unique([fk_id_user, name])
  @@map("knowledge")
}

model EventComment {
  id          Int      @id @default(autoincrement())
  uuid        String   @unique @default(uuid()) @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at")
  user        User     @relation(fields: [fk_id_user], references: [id])
  fk_id_user  Int
  event       Event    @relation(fields: [fk_id_event], references: [id])
  fk_id_event Int
  text        String
  starts      Int

  @@map("event_comment")
}
